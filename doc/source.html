<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML>
<HEAD>

<META NAME="Generator" CONTENT="WebWriter/2 v1.2">
<TITLE>ASC documentation: The Source</TITLE>
	<LINK REL="stylesheet" TYPE="text/css" HREF="asc.css">
</HEAD>

<BODY text="#000000" bgcolor="#ffffff">

<CENTER>
<H1>Advanced Strategic Command</H1>
<P>documentation<P>
<H2>The Source</H2>
</CENTER>
I started writing the program and designed the basic game system in 1994 using Borland Pascal as the programming language. In 1995 I started using object orientated programming and in 1996 I converted the whole project to Watcom C/C++. We started the port to GCC and Linux in 1999. If you look at the source you will "see" this history. If I started such a project now from scratch I would design it completely different (for example a client / server design and everything much more object oriented). But we have the project as it is and are trying to improve it in that direction without rewriting it from scratch.<P>

The source code is not very well structured and documented. I always preferred writing cool new features instead of cleaning up the code :-) <BR>
We are going to improve this gradually. Don't hesitate to <A HREF="contact.html">contact us</A> if you have any questions regarding the source code or anything else about the game.<P>


Another "historical" thing about the source code is the language (not the programming language) that was used for it. Since we did not intend to release the source code we used a mixture of German and English for variable- and function names and avoided writing comments and those that we have are mostly in German. We have now run several translation passes through the code to translate it to English. The global interfaces should be completely in English now, but several local variables may still be in German. Since we run the translation through the code by a source code wide "search and replace" there are now some comments and perhaps a few code elements that were negatively affected by it and sound quite funny.<P>

<H3>Required Tools</H3>
<H4>for building the DOS version</H4>
The DOS version has been discontinued, mainly because of limited support for certain C++ language constructs by Watcom C++. The build instruction are left here for the case that some future version of Watcom C++ may be ANSI C++ compliant.

<BLOCKQUOTE>
We are developing the project with Watcom C/C++ Version 11.0b. The project files for the Watcom IDE are included. It has been anounced that Watcom C/C++ is going to be released as Open Source. Check out <A HREF="http://www.openwatcom.org">www.openwatcom.org</A>.<P>
The assembler files (with the exception of <TT>RDTSC.ASM</TT>) can not be assembled by WASM since it does not support the high level language interfaces that TASM ( we are using version 3.2) provides. The bach file <TT>asc\source\watcom.bat</TT> assembles all asm files that are needed, provided that TASM is in the path. But the assembled OBJ files are included so you don't need Tasm unless you want to modify the assembler files.<P>

Since Watcom C++ does not come with the STL, we use STLport 4.0 which can be obtained from <A HREF="http://www.stlport.org">www.stlport.org</A>. Some notes about installing STLPORT 4.0 :
<UL>
<LI>Include the stlport directory to your INCLUDE enivironment variable before the original watcom entries. 
<LI>You may also need to edit the file stlport\stl_user_config.h and uncomment line <TT>#define __STL_NO_SGI_IOSTREAMS</TT>.
<LI>Edit file stlport\stl\_alloc.h, line #879 and add an extra '0' argument:<BR>
<TT>return __stl_alloc_rebind(__STATIC_CAST(_Base&.*this),(_Tp*)0).allocate(__n,0); </TT>
</UL>

Please read the <A HREF="../source/libs/readme.txt">library readme</A> file as well. There are the links for getting the JPEG sources.

As host platform for the development we use OS/2 and as target platform (you should have already noticed that) DOS with DOS4GW as 32bit extender. It should be no problem to develop with Win9x as host platform with Watcom C/C++ except that debugging might be a bit problematic, but that's neither our not Watcom's fault (why is Microsoft not capable of implementing DPMI 1.0 ??).<P>
</BLOCKQUOTE>

<H4>for building the Windows version</H4>
We are building ASC/win with Borland C++ Builder 5. It should be possible to build ASC with other Windows compilers too, if they have some sufficient understanding of the C++ language. Microsoft Visual C++ has not, at least not the version 5 which I tested. Don't invest any time trying to make ASC compilable with MSVC, I'm not going to restrict my programming to Microsofts subset of C++. Period. There are more capable Win32 compilers around, even some free ones. 

<A HREF="http://www.borland.com">Borland</A> C++ for example. The command line version of compiler and debugger are available for free download. Compiling ASC with it should just be a matter of writing Makefiles. <P>

<H5>Borland C++ Builder</H5>

<UL>
<LI>JPEG-lib by the <A HREF="http://www.ijg.org">Independant Jpeg Group</A>. On their homepage are links where you can download the source code.
<LI>Uncompress the JPEG-lib source code into asc/source/libs/jpeg-6b/
<LI>SDL. It can be downloaded from <A HREF="http://www.libsdl.org">www.libsdl.org</A>. You need the source code and the DLL file (version 1.1 or newer). 
<LI>The project files assume there is a <TT>SDL</TT> directory located in the same directory where <TT>asc</TT> is placed. You need this directory structure:<BR>  <TT>
    asc\<BR>
    asc\source\<BR>
    asc\doc\<BR>
    SDL\<BR>
    SDL\include\<BR>
    SDL\src\
    </TT>
<LI>Create a subdirectory called BIN in <TT>SDL\</TT> and put the SDL.DLL into it.
<LI>Go to this directory and run: <TT>IMPLIB -a -c SDL.LIB SDL.DLL</TT>
</UL>
The project files for the Borland C++ Builder are included in the asc/ directory. <P>


<H5>Watcom C++</H5>

Until December 2000 we built ASC/win with Watcom C/C++ , but since it is not fully ANSI C++ compliant, it cannot compile the AI which I'm writing at the time of writing (Dec. 2000). Perhaps some future version of Watcom C++ will understand all the C++, so here are the (old) instructions on how to build ASC with Watcom C++
<BLOCKQUOTE>
To build ASC/win with Watcom, you need:
<UL>
<LI>STLport. See the paragraph about it in the DOS section.
<LI>JPEG-lib by the <A HREF="http://www.ijg.org">Independant Jpeg Group</A>. On their homepage are links where you can download the source code.
<LI>Uncompress the JPEG-lib source code into asc/source/libs/jpeg-6b/
<LI>SDL. It can be downloaded from <A HREF="http://www.libsdl.org">www.libsdl.org</A>. You need the source code and the DLL file (version 1.1 or newer). 
<LI>Uncompress the SDL source  to some directory and define an environment variable SDLDIR which points to this directory (without a trailing backslash). 
<LI>Create a subdirectory called DLL in asc/source/sdl and put the SDL.DLL into it.
</UL>
The project files for the Watcom IDE are included in the asc/source/win32 directory. 
<P>
</BLOCKQUOTE>

<H4>for building the Linux version</H4>
Well, nothing special about that. We build ASC with the standard GNU development tools. Refer to INSTALL for (generic) build instructions.


<H3>Source code formatting</H3>
Since there are many different source code formatting styles out there, it would be quite a mess if everybody used his own style and spends half his time undoing the formatting that others did. I don't want to force everybody to use exactly the same formatting, but if some source is <B>re</B>formatted, then to a well defined layout.
<A HREF="http://astyle.sourceforge.net/astyle/">Artistic Style</A> is a capable program for formatting source code.
The settings <TT>--style=linux -s3 -C -S</TT> are recommended to be used for ASC. If you write these settings to a file <TT>~/.astylerc</TT>, you don't need to type them each time you call Astyle. The central setting there is the -s3, which tells Astyle to indent with 3 spaces.<P>

<strong>Some nested and nasty #ifdefs can confuse Astyle. After using Astyle, check the last line of the source file and verify they are correctly indented. If they are not, either fix the #ifdef or restore to the backup file that was created by Astyle!</strong><P>

I personally don't like cutting breaking each line after 80 characters. The times when that was the upper limit of what a monitor could display at once are long passed. And since the first 120 characters (or whatever the size of your screen is) of a command are usually sufficient to get an idea what it is doing, I prefer to not have the next line cluttered with some coordinate calculations that nobody is really interested in.
But, as always, there are exceptions where it helps to break a command into several lines...
<P>


<H3>Porting ASC</H3>
Porting ASC to any platform supported by SDL should be farely easy (as long as it is 32 bit and has Intel byte order). 

<H3>The source documentation</H3>
The source documentation system used for ASC is <A HREF="http://www.stack.nl/~dimitri/doxygen/">doxygen</A>. The doxygen configuration file is <TT>asc/source/doxygen.config</TT>.

<H3>A short walk through the ASC source</H3>

THE central class of ASC is <CODE>tmap</CODE> in <TT>gamemap.h</TT>. It is the anchor where nearly all elements of ASC are chained to. The global variable <CODE>actmap</CODE> is a pointer to the active map. There can be a maximum of 8 players on a map, plus neutral units (which are handled like a 9th player). Hence the array of 9 <CODE>Player</CODE> classes inside <CODE>tmap</CODE>. <P>
Each player has units and buildings, which are stored in the lists <CODE>vehicleList</CODE> and <CODE>buildingList</CODE>. The terms units and vehicles are used synonymously in ASC. Since unit was a reserved word in Borland Pascal, we decided to use the term vehicle instead. But now, with ASC written in C++, 'unit' is also used.<P>
Every building and unit is of a certain 'type'. The <CODE>vehicletypes</CODE> and <CODE>buildingtypes</CODE> are stored in the <TT>*.veh</TT> and <TT>*.bld</TT> files, are loaded on startup and globally available. They are not modified during runtime in any way and are referenced by the vehicles and buildings. The <CODE>vehicletype</CODE> has information that are shared by all vehicles of this 'type', like speed, weapon systems, accessable terrain etc, while the <CODE>vehicle</CODE> stores things like remaining movement for this turn, ammo, fuel and cargo.<P>
The <CODE>Vehicle</CODE>, <CODE>Vehicletype</CODE> and <CODE>Buildingtype</CODE> classes are defined in files having the same name as the class, while the <CODE>Building</CODE> class is defined in <TT>building<B>s</B>.h</TT>, since <TT>building.*</TT> was already used for something different. <P>
The primary content of a map are its fields. Each field has again a pointer to a certain weather of a <CODE>terraintype</CODE>. Each terraintype (can currently be found in <TT>typen.h</TT>, but will be moved to its own file sooner of later) has up to 5 different weathers ("dry (standard)","light rain", "heavy rain", "few snow", "lot of snow"). If there is a unit or a building standing on a field, it has a pointer to it. <P>
On the field can be several <CODE>Objects</CODE>. Objects are another central class of ASC. Roads, pipleines, trenches and woods are examples of objects.


</BODY>
</HTML>
