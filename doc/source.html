<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML>
<HEAD>

<META NAME="Generator" CONTENT="WebWriter/2 v1.2">
<TITLE>ASC documentation: The Source</TITLE>
	<LINK REL="stylesheet" TYPE="text/css" HREF="asc.css">
</HEAD>

<BODY text="#000000" bgcolor="#ffffff">

<CENTER>
<H1>Advanced Strategic Command</H1>
<P>documentation<P>
<H2>The Source</H2>
</CENTER>
I started writing the program and designed the basic game system in 1994 using Borland Pascal as the programming language. In 1995 I started using object orientated programming and in 1996 I converted the whole project to Watcom C/C++. We started the port to GCC and Linux in 1999. If you look at the source you will "see" this history. If I started such a project now from scratch I would design it completely different (for example a client / server design and everything much more object oriented). But we have the project as it is and are trying to improve it in that direction without rewriting it from scratch.<P>

The source code is not very well structured and documented. I always preferred writing cool new features instead of cleaning up the code :-) <BR>
We are going to improve this gradually. Don't hesitate to <A HREF="contact.html">contact us</A> if you have any questions regarding the source code or anything else about the game.<P>


Another "historical" thing about the source code is the language (not the programming language) that was used for it. Since we did not intend to release the source code we used a mixture of German and English for variable- and function names and avoided writing comments and those that we have are mostly in German. We have now run several translation passes through the code to translate it to English. The global interfaces should be completely in English now, but several local variables may still be in German. Since we run the translation through the code by a source code wide "search and replace" there are now some comments and perhaps a few code elements that were negatively affected by it and sound quite funny.<P>

<H3>Required Tools</H3>
<H4>for building the DOS version</H4>
We are developing the project with Watcom C/C++ Version 11.0b. The project files for the Watcom IDE are included. It has been anounced that Watcom C/C++ is going to be released as Open Source. Check out <A HREF="http://www.openwatcom.org">www.openwatcom.org</A>.<P>
The assembler files (with the exception of <TT>RDTSC.ASM</TT>) can not be assembled by WASM since it does not support the high level language interfaces that TASM ( we are using version 3.2) provides. The bach file <TT>asc\source\watcom.bat</TT> assembles all asm files that are needed, provided that TASM is in the path. But the assembled OBJ files are included so you don't need Tasm unless you want to modify the assembler files.<P>

Since Watcom C++ does not come with the STL, we use STLport 4.0 which can be obtained from <A HREF="http://www.stlport.org">www.stlport.org</A>. Some notes about installing STLPORT 4.0 :
<UL>
<LI>Include the stlport directory to your INCLUDE enivironment variable before the original watcom entries. 
<LI>You may also need to edit the file stlport\stl_user_config.h and uncomment line <TT>#define __STL_NO_SGI_IOSTREAMS</TT>.
<LI>Edit file stlport\stl\_alloc.h, line #879 and add an extra '0' argument:<BR>
<TT>return __stl_alloc_rebind(__STATIC_CAST(_Base&.*this),(_Tp*)0).allocate(__n,0); </TT>
</UL>

Please read the <A HREF="../source/libs/readme.txt">library readme</A> file as well. There are the links for getting the JPEG sources.

As host platform for the development we use OS/2 and as target platform (you should have already noticed that) DOS with DOS4GW as 32bit extender. It should be no problem to develop with Win9x as host platform with Watcom C/C++ except that debugging might be a bit problematic, but that's neither our not Watcom's fault (why is Microsoft not capable of implementing DPMI 1.0 ??).<P>

<H4>for building the Windows version</H4>
We are building ASC/win with Watcom C/C++ Version 11.0b. It should be possible to build ASC with other Windows compilers too, if they have some sufficient understanding of the C++ language. Microsoft Visual C++ has not, at least not the version 5 which I tested. Don't invest any time trying to make ASC compilable with MSVC, I'm not going to restrict my programming to Microsofts subset of C++. Period. There are more capable Win32 compilers around, even some free ones. 

<A HREF="http://www.borland.com">Borland</A> C++ for example. The command line version of compiler and debugger are available for free download. Compiling ASC with it should just be a matter of writing Makefiles. <P>

To build ASC/win with Watcom, you need:
<UL>
<LI>STLport. See the paragraph about it in the DOS section.
<LI>SDL. It can be downloaded from <A HREF="http://www.libsdl.org">www.libsdl.org</A>. You need the source code and the DLL file. 
<LI>Uncompress the SDL source  to some directory and define an environment variable SDLDIR which points this directory (without a trailing backslash). 
<LI>Create a subdirectory called DLL in asc/source/sdl and put the SDL.DLL into it.
</UL>
The project files for the Watcom IDE are included in the asc/source/win32 directory. 
<P>


<H4>for building the Linux version</H4>
Well, nothing special about that. We build ASC with the standard GNU development tools. Refer to INSTALL for (generic) build instructions.


<H3>Source code formatting</H3>
Since there are many different source code formatting styles out there, it would be quite a mess if everybody used his own style and spends half his time undoing the formatting that others did. So we should agree on a common layout. 
<A HREF="http://astyle.sourceforge.net/astyle/">Artistic Style</A> is a capable program for formatting source code.
The settings <TT>--style=linux -s3 -C -S</TT> are recommended to be used for ASC. If you write these settings to a file <TT>~/.astylerc</TT>, you don't need to type them each time you call Astyle. The central setting there is the -s3, which tells Astyle to indent with 3 spaces.<P>

<strong>Some nested and nasty #ifdefs can confuse Astyle. After using Astyle, check the last line of the source file and verify they are correctly indentend. If they are not, either fix the #ifdef or restore to the backup file that was created by Astyle!</strong><P>

I personally don't like cutting breaking each line after 80 characters. The times when that was the upper limit of what a monitor could display at once are long passed. And since the first 120 characters (or whatever the size of your screen is) of a command are usually sufficient to get an idea what it is doing, I prefer to not have the next line cluttered with some coordinate calculations that nobody is interested in. 
But, as always, there are exceptions where it helps to break a command into several lines...
<P>


<H3>Porting ASC</H3>
Porting ASC to any platform supported by SDL should be farely easy (as long as it is 32 bit and has Intel byte order). 

<H3>The source files</H3>
A short overview of the various source files ASC consists of (outdated, I've started using doxygen for the source documentation)

<DL>
<DT><A HREF="../source/artint.cpp">artint.cpp</A>
<DD>
The artificial intelligence. The file is not compileable at them moment, but will be reactivated soon.
<BR><I>used by: </I><I>used by: </I>main program

<DT><A HREF="../source/attack.cpp">attack.cpp</A>
<DD>The attack routines: unit vs. unit, unit vs. object, unit vs. building
<BR><I>used by: </I>main program

<DT><A HREF="../source/basegfx.cpp">basegfx.cpp</A>
<DD>Platform independant graphic routines. Mostly modifying of raw images
<BR><I>used by: </I>main program, map editor, small editors

<DT><A HREF="../source/basestrm.cpp">basestrm.cpp</A>
<DD>Basic file IO, absolutely platform- and ASC independant. Stream functions for accessing container files, memory, ...
<BR><I>used by: </I>everything

<DT><A HREF="../source/building.cpp">building.cpp</A>
<DD>routines for buildings and transports (sometimes called "container"). Containercontrols offer the functionaligy, ccontainer_t/b the GUI 
<BR><I>used by: </I>main program

<DT><A HREF="../source/controls.cpp">controls.cpp</A>
<DD>Originally designed to contain all routines for controlling units, but everything affecting the map, its units etc but is not used by the mapeditor was placed here, so it is quite a varied collection of routines. In contrast, everything that is used by 
the mapeditor is placed in SPFST.CPP 
<BR><I>used by: </I>main program

<DT><A HREF="../source/dialog.cpp">dialog.cpp</A>
<DD>All dialog boxes that are used by the mapeditor and the main program
<BR><I>used by: </I>main program, mapeditor

<DT><A HREF="../source/dlg_box.cpp">dlg_box.cpp</A>
<DD>The dialogbox engine. Contains some fundamental dialog box, for displaying messages, larger texts (like the help texts), too
<BR><I>used by: </I>main program, mapeditor


<DT><A HREF="../source/edevents.cpp">edevents.cpp</A>
<DD>editing the events 
<BR><I>used by: </I>mapeditor

<DT><A HREF="../source/edgen.cpp">edgen.cpp</A>
<DD>generating random maps
<BR><I>used by: </I>mapeditor

<DT><A HREF="../source/edglobal.cpp">edglobal.cpp</A>, <A HREF="../source/edmain.cpp">edmain.cpp</A>, 
<A HREF="../source/edmisc.cpp">edmisc.cpp</A>
<DD>The central files of the mapeditor
<BR><I>used by: </I>mapeditor

<DT><A HREF="../source/edselfnt.cpp">edselfnt.cpp</A>
<DD>Selecting units, buildings, objects, weather, ...
<BR><I>used by: </I>mapeditor

<DT><A HREF="../source/gamedlg.cpp">gamedlg.cpp</A>
<DD>dialog boxes that are not used in the mapeditor
<BR><I>used by: </I>main program

<DT><A HREF="../source/gui.cpp">gui.cpp</A>
<DD>The buttons for unit actions: movement, attack, ...
<BR><I>used by: </I>main program

<DT><A HREF="../source/history.cpp">history.cpp</A>
<DD>Originally planed to provide history functions for ASC, but was never finished. Long derelicted.
<BR><I>used by: </I>planned for use in the main program

<DT><A HREF="../source/loadbi3.cpp">loadbi3.cpp</A>
<DD>Routines for loading maps and graphics from Battle Isle 2 / 3 (Battle Isle 2200 / 2220 in the US)
<BR><I>used by: </I>main program, mapeditor, small editors

<DT><A HREF="../source/loaders.cpp">loaders.cpp</A>
<DD>Loading and writing maps, save games, email files
<BR><I>used by: </I>main program, mapeditor

<DT><A HREF="../source/loadjpg.cpp">loadjpg.cpp</A>
<DD>Loading of JPEG files (DOS only)


<DT><A HREF="../source/loadpcxc.cpp">loadpcxc.cpp</A>
<DD>Loading and writing PCX files, C code (in contrast to <A HREF="../source/dos/loadpcx.cpp">dos/loadpcx.cpp</A>, which uses ASM)
<BR><I>used by: </I>main program, mapeditor

<DT><A HREF="../source/misc.cpp">misc.cpp</A>
<DD>Small miscellaneous functions
<BR><I>used by: </I>main program, mapeditor, small editors

<DT><A HREF="../source/missions.cpp">missions.cpp</A>
<DD>Handling of map events
<BR><I>used by: </I>main program

<DT><A HREF="../source/network.cpp">network.cpp</A>
<DD>currently only used for providing email game functionality, but designed for data transfer in general
<BR><I>used by: </I>main program

<DT><A HREF="../source/newfont.cpp">newfont.cpp</A>
<DD>Font loading and displaying
<BR><I>used by: </I>main program, mapeditor, some small editors

<DT><A HREF="../source/objxlat.cpp">objxlat.cpp</A>
<DD>included by loadpcx.cpp

<DT><A HREF="../source/oldlzw.cpp">oldlzw.cpp</A>
<DD>included by basestrm.cpp

<DT><A HREF="../source/palette.cpp">palette.cpp</A>
<DD>handling the 8bit palette
<BR><I>used by: </I>main program, mapeditor, small editors

<DT><A HREF="../source/pd.cpp">pd.cpp</A>
<DD>The pulldown menu
<BR><I>used by: </I>main program, mapeditor

<DT><A HREF="../source/sg.cpp">sg.cpp</A>
<DD>The main program of ASC
<BR><I>used by: </I>main program

<DT><A HREF="../source/sgstream.cpp">sgstream.cpp</A>
<DD>ASC specific file IO, for loading and writing of vehicles, buildings, objects, ...
<BR><I>used by: </I>main program, mapeditor, small editors

<DT><A HREF="../source/soundList.cpp">soundList.cpp</A>
<DD>Loading and handling of all sounds in ASC
<BR><I>used by: </I>main program

<DT><A HREF="../source/spfst.cpp">spfst.cpp</A>
<DD>Name comes from german "Spielfeldsteuerung", english "map control". Contains everything arount the map that is used by the mapeditor and the main program. All routines that are only used in the main program are placed in controls.cpp
<BR><I>used by: </I>main program, mapeditor

<DT><A HREF="../source/stack.cpp">stack.cpp</A>
<DD>A small, general purpose, not-type-save stack
<BR><I>used by: </I>main program, mapeditor, small editors

<DT><A HREF="../source/strtmesg.cpp">strtmesg.cpp</A>
<DD>Contains the version number of ASC and the about start message of ASC and the mapeditor
<BR><I>used by: </I>main program, mapeditor

<DT><A HREF="../source/typen.h">typen.h</A>, <A HREF="../source/typen.cpp">typen.cpp</A>
<DD>The definitions of the central ASC structures. 
<BR><I>used by: </I>main program, mapeditor, small editors

<DT><A HREF="../source/unitctrl.cpp">unitctrl.cpp</A>
<DD>The new interface for controlling of the units. Foundation for the upcoming AI
<BR><I>used by: </I>main program

<DT><A HREF="../source/weather.cpp">weather.cpp</A>
<DD>Weather change and mapchange events are executed here, as well as all polygon processing
<BR><I>used by: </I>main program, mapeditor

</DL>
	
</BODY>
</HTML>
