dnl Process this file with autoconf to produce a configure script.
AC_INIT(Makefile.am)

AM_CONFIG_HEADER(config.h)

AM_INIT_AUTOMAKE(asc,1.2.0)

dnl Checks for programs.
AC_PROG_CC
CFLAGS="$CFLAGS -D_UNIX_ -D_SDL_ -D_NOASM_"
AC_PROG_CXX
CXXFLAGS="$CXXFLAGS -DHEXAGON -funsigned-char -D_UNIX_ -D_SDL_ -D_NOASM_"
AC_PROG_RANLIB
dnl Checks for libraries.

dnl Checks for some STL header files (which aren't available for gcc at the time of writing).
AC_CHECK_HEADERS( exception limits )

dnl Checks for other header files.
AC_HEADER_STDC
AC_CHECK_HEADERS(malloc.h strings.h sys/dirent.h)
AC_HEADER_DIRENT
AC_HEADER_TIME
dnl Allow location of SDL install to be configured --with-SDL-prefix=
dnl omitting this parameter will cause the files to be sought in /usr/lib and /usr/include
dnl note that you need to have run make install in the SDL source for this to work, as the
dnl SDL distribution source directory isn't layed out correctly even after a make.
AC_ARG_WITH( SDL-prefix,\
[  --with-SDL-prefix=sdlp  Look for SDL libs in \${sdlp}/lib and headers in\
 \${sdlp}/include/],\
CXXFLAGS="$CXXFLAGS -I$withval/include" ; CPPFLAGS="$CPPFLAGS -I$withval/include" ; LDFLAGS="$LDFLAGS -L$withval/lib" )


AC_CHECK_HEADER( SDL/SDL.h, , AC_MSG_ERROR( ASC requires SDL headers to be present ) )

dnl Checks for typedefs, structures, and compiler characteristics.
AC_C_CONST
AC_TYPE_SIZE_T

dnl Checks for libraries.
AC_CHECK_LIB( pthread, pthread_create )
dnl AC_CHECK_LIB( SDL-1.1, SDL_EnableKeyRepeat, echo " ", AC_MSG_ERROR( ASC requires SDL 1.1.3 or newer to be installed ) )

dnl libbz2 stuff (should have a versionnr about 1.0.0)
lib_bz2_static=no
AC_ARG_ENABLE( libbz2-static, [  --enable-libbz2-static compiles a static \
libbz2 into the binary of asc.], [lib_bz2_static=$enableval], \
[lib_bz2_usecache=yes] )
AC_CHECK_LIB( bz2, BZ2_bzReadOpen, [], [checklib_bz2_static=yes] )
AC_CACHE_CHECK( [for static libbz2 flag state], [ac_cv_lib_bz2_static],
[ ac_cv_lib_bz2_static=$lib_bz2_static ] )
dnl ac_cv_lib_bz2_static holds cached flag state, checklib_bz2... holds check
dnl now combine them with the current flag state if needed
if test "x$lib_bz2_usecache" = "xyes"; then
  lib_bz2_static=$ac_cv_lib_bz2_static;
else
  ac_cv_lib_bz2_static=$lib_bz2_static;
fi
if test "x$checklib_bz2_static" = "xyes"; then
  lib_bz2_static=yes;
fi

AC_MSG_RESULT( [making static libbz2... $lib_bz2_static] )

if test "x$if test "x$ac_cv_lib_bz2_static" = "x$lib_bz2_static"; then
lib_bz2_static" = "xyes"; then
  LIBBZ2=bzlib
  LDADDLIBBZ2=libs/bzlib/libbz2.a;
else
  LDADDLIBBZ2=-lbz2
fi

SDL_VERSION=1.1.3
      AM_PATH_SDL($SDL_VERSION,
                  :,
                  AC_MSG_ERROR([*** SDL version $SDL_VERSION not found!])
      )

dnl Checks for library functions.
AC_CHECK_FUNCS(select)
AC_CHECK_FUNCS(itoa)
AC_CHECK_FUNCS(stricmp)
AC_CHECK_FUNCS(log2)

dnl shell vars set by test&feature flag for libbz2
AC_SUBST([LIBBZ2])
AC_SUBST([LDADDLIBBZ2])

AC_OUTPUT(Makefile source/Makefile source/mapedit/Makefile source/docs/Makefile source/docs/en/Makefile source/sdl/Makefile source/libs/triangul/Makefile source/tools/Makefile source/tools/linux/Makefile source/libs/Makefile )


